# 原生拖放

## 前言

IE4最早引入JS拖放功能，但是只有图像和文本可以被拖动，而文本框是唯一的可防止目标。IE5几乎任何元素都可做放置目标，IE5.5任何元素都可拖放。HTML5是以IE为基础来定制拖放的规范的。

不仅是在单个页面内进行拖放，还可以在多个页面窗口间进行，甚至操作系统与浏览器之间也可以进行拖放。

## 可拖动

**在默认情况下，只有图像，链接和文本是可以拖动的。**

HTML5为所有元素规定了一个`draggable` 属性，所以让元素可以被拖动只要将该属性设置为`true`即可。

注意：为了让Firefox支持可拖动属性还必须添加一个`ondragstart`事件处理程序，并在`dataTransfer`对象中保存一些信息，下文马上会提及`dragstart`事件和`dataTransfer`对象。

## 拖放事件

拖放事件按对象分成两部分，第一是被拖动的元素对象，第二是放置目标。

拖动元素时候，将依次发生:

1. `dragstart`
2. `drag`
3. `dragend`

### `dragstart`

按下鼠标并移动鼠标。我们可以简单的理解为触发了`mousedown`和`mousemove`两个事件，缺一不可, 该事件只会被触发一次。

### `drag`

这个事件是在`dragstart`事件触发后随即触发的，即在元素被拖动期间持续不断地触发,也可以简单理解为`mousemove`。

### `dragend`

当松开鼠标左键的时候就会触发，**不论放置目标允不允许放置**。`mouseup`相当。

大多数浏览器会为拖动元素创建一个半透明副本，并随着鼠标移动。

---------------------------------------------------------

对一个有效的放置的目标而言，它会因此发生以下事件：

1. `dragenter`
2. `dragover`
3. `dragleave`或 `drop`

###有效放置目标

默认情况下一般只有文本框可以放置，不过我们而已自定义来设置，先选取放置目标，再将其`dragenter`或`dragover`事件的默认行文取消就好。

```javascript
var droptarget = document.getElementById('target');

droptarget.ondragenter = function(event) {
  event.preventDefault();
};

droptarget.ondragover = function(event) {
  event.preventDefault();
};
```

当拖放元素原本在放置目标之外其实只要取消enter的默认行为即可，如果原本就在容器内，必须得取消over的默认行为才行。？？好像都得设置over

### `dragenter`

只要元素被拖动到放置目标上，就会触发该事件，类似`mouseover`事件

### `dragover`

当元素在目标上并且还按着鼠标未松开就会持续触发该事件，不移动也会触发（实际上细微地也是在移动的, 因为不动鼠标over触发慢移动的话over触发快）。

### `drop`

松开鼠标，把元素放置到可放置目标时触发。与`dragend`事件不同的是，它还需要是一定得放置在有效目标才行，条件更为严苛。

### `dragleave`

当拖动元素离开可放置目标触发。**判定的标准不是被拖动的元素边缘是否出界，而是拖动元素的鼠标是否离开那个放置目标**，enter也是。

**当拖动的鼠标再次接触到原始元素的边界时会触发`dragenter`和`dragleave`**

### Firefox3.5+中放置事件

如在Chrome中向文本框放置文本就是复制文字副本进去，而在Firefox 3.5+中**放置事件的默认行为就是打开被放置目标的URL**，换句话说就是图像会转向图像文件，URL就会打开网页，文本就是无效的URL也会打开。

因此要实现正常拖放得阻止其默认行为

```javascript
droptarget.ondrop = function(){
	event.preventDefault();
};
```

## `dataTransfer`对象

为了实现数据交换，IE5引入了`dataTransfer`对象，它是事件对象的一个属性，因此它只能在拖动事件处理程序中被访问。

该对象主要通过两个方法来数据传递, `setData()`和`getData()`。

